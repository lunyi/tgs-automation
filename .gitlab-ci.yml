stages:
  - build-and-test
  - docker-build-push
  - deploy

variables:
  Registry: "pgtgs"
  Tag: "latest"

before_script:
  - docker info
  
build_job:
  stage: build-and-test
  only:
    - main
  script:
    - ls -al
    - pwd
    - hostname
    - export PATH=$PATH:/usr/local/go/bin
    - echo "PATH=$PATH"
    - go mod download
    - go build ./...
    - go test ./...


build_template: &build_definition
  stage: docker-build-push
  script:
    - echo "Building $FEATURE_NAME"
    - echo "Building $IMAGE_NAME"
    - docker build -t $IMAGE_NAME -f features/$FEATURE_NAME/Dockerfile . 
    - docker push $IMAGE_NAME
  only:
    - main

# build_monthly_expired_domains:
#   <<: *build_definition
#   variables:
#     FEATURE_NAME: "monthly-expired-domains"
#     IMAGE_NAME: "$Registry/$FEATURE_NAME:$Tag"
    
build_daily_brands_revenue:
  variables:
    FEATURE_NAME: "daily-brands-revenue"
    IMAGE_NAME: "$Registry/$FEATURE_NAME:$Tag"
  stage: docker-build-push
  script:
    - echo "Building $FEATURE_NAME"
    - echo "Building $IMAGE_NAME"
    - docker build -t $IMAGE_NAME -f features/$FEATURE_NAME/Dockerfile . 
    - docker push $IMAGE_NAME
  only:
    - main


# build_daily_momo_first_deposit:
#   <<: *build_definition
#   variables:
#     FEATURE_NAME: "daily-momo-first-deposit"
#     IMAGE_NAME: "$Registry/$FEATURE_NAME:$Tag"

# build_weekly_brands_statistics:
#   <<: *build_definition
#   variables:
#     FEATURE_NAME: "weekly-brands-statistics"
#     IMAGE_NAME: "$Registry/$FEATURE_NAME:$Tag"